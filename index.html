<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JO10 Trainer">
    <meta name="theme-color" content="#0047AB">
    <meta name="description" content="VV Hooglanderveen JO10 Trainersapp">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>JO10 Trainer</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #0047AB 0%, #003380 100%);
            color: #fff; 
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, rgba(255,215,0,0.95) 0%, rgba(255,193,7,0.9) 100%);
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .header-logo {
            width: 36px; height: 36px;
            background: #0047AB;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
        }
        .header-text h1 { font-size: 0.85em; color: #0047AB; font-weight: 700; }
        .header-text p { font-size: 0.7em; color: #003380; }
        .sync-status {
            margin-left: auto;
            font-size: 0.7em;
            padding: 4px 8px;
            border-radius: 12px;
            background: rgba(0,71,171,0.2);
            color: #0047AB;
        }
        .sync-status.online { background: rgba(39,174,96,0.2); color: #1e8449; }
        .sync-status.saving { background: rgba(255,215,0,0.3); color: #d4ac0d; }
        
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            z-index: 999;
            display: none;
            animation: fadeInOut 2s ease;
        }
        .toast.show { display: block; }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateX(-50%) translateY(10px); }
            15%, 85% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        .team-select {
            display: flex;
            gap: 6px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            justify-content: center;
            flex-wrap: wrap;
        }
        .team-btn {
            padding: 8px 14px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            color: rgba(255,255,255,0.8);
            font-weight: 600;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s;
        }
        .team-btn.active {
            border-color: #FFD700;
            background: rgba(255,215,0,0.15);
            color: #FFD700;
        }
        .team-btn.mix {
            background: linear-gradient(135deg, rgba(155,89,182,0.3), rgba(142,68,173,0.2));
            border-color: rgba(155,89,182,0.5);
        }
        .team-btn.mix.active {
            border-color: #9b59b6;
            color: #bb8fce;
        }
        
        .opponent-bar {
            background: rgba(0,0,0,0.25);
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8em;
        }
        .opponent-bar label { color: rgba(255,255,255,0.7); }
        .opponent-bar input {
            flex: 1;
            padding: 6px 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 6px;
            color: #FFD700;
            font-size: 0.9em;
            font-weight: 600;
        }
        .opponent-bar input::placeholder { color: rgba(255,215,0,0.5); }
        
        .tabs {
            display: flex;
            background: rgba(0,0,0,0.2);
            border-bottom: 2px solid rgba(255,215,0,0.3);
        }
        .tab {
            flex: 1;
            padding: 10px 6px;
            text-align: center;
            cursor: pointer;
            font-size: 0.75em;
            font-weight: 600;
            color: rgba(255,255,255,0.6);
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .tab.active { 
            border-bottom-color: #FFD700; 
            color: #FFD700;
        }
        
        .content { padding: 12px; display: none; max-width: 500px; margin: 0 auto; }
        .content.active { display: block; }
        
        .quarter-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }
        .quarter-tab {
            flex: 1;
            padding: 8px;
            background: rgba(255,255,255,0.08);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            color: rgba(255,255,255,0.7);
            transition: all 0.2s;
        }
        .quarter-tab.active {
            border-color: #FFD700;
            color: #FFD700;
            background: rgba(255,215,0,0.1);
        }
        
        /* AUTO BUTTON */
        .auto-btn {
            padding: 8px 14px;
            background: rgba(39,174,96,0.15);
            border: 1px solid rgba(39,174,96,0.4);
            border-radius: 6px;
            color: #58d68d;
            font-weight: 600;
            font-size: 0.75em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: all 0.2s;
        }
        .auto-btn:hover { background: rgba(39,174,96,0.25); }
        .auto-btn:active { transform: scale(0.98); }
        .auto-btn.reset {
            background: rgba(231,76,60,0.1);
            border-color: rgba(231,76,60,0.3);
            color: #e74c3c;
        }
        .auto-btn.reset:hover { background: rgba(231,76,60,0.2); }
        
        /* FORMATIE SELECTOR */
        .formation-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            justify-content: center;
        }
        .formation-btn {
            padding: 6px 12px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 6px;
            color: rgba(255,255,255,0.6);
            font-size: 0.75em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .formation-btn.active {
            border-color: #FFD700;
            color: #FFD700;
            background: rgba(255,215,0,0.1);
        }
        
        /* VELD */
        .field {
            background: linear-gradient(to bottom, #2d8a2d 0%, #1f6b1f 50%, #2d8a2d 100%);
            border-radius: 10px;
            padding: 12px 8px;
            min-height: 280px;
            border: 3px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }
        .field::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 8%;
            right: 8%;
            height: 2px;
            background: rgba(255,255,255,0.35);
        }
        .field::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 2px solid rgba(255,255,255,0.35);
            border-radius: 50%;
        }
        
        .position-row {
            display: flex;
            justify-content: space-evenly;
            padding: 0 10px;
            margin: 8px 0;
            position: relative;
            z-index: 1;
        }
        .position-row.attack { margin-top: 12px; }
        .position-row.midfield { margin: 30px 0; }
        .position-row.defense { margin-bottom: 8px; }
        .position-row.keeper { margin-top: 20px; justify-content: center; }
        
        .position {
            background: linear-gradient(135deg, #0047AB 0%, #003380 100%);
            border: 2px solid #FFD700;
            border-radius: 8px;
            padding: 6px 4px;
            min-width: 58px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: transform 0.15s;
        }
        .position:active { transform: scale(0.95); }
        .position.keeper { 
            background: linear-gradient(135deg, #FFD700 0%, #e6c200 100%);
            border-color: #0047AB;
        }
        .position .pos-label {
            font-size: 0.55em;
            color: #FFD700;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        .position.keeper .pos-label { color: #0047AB; }
        .position .player-name {
            font-size: 0.7em;
            margin-top: 2px;
            font-weight: 600;
            color: #fff;
            min-height: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .position.keeper .player-name { color: #0047AB; }
        .position.no-rest {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            border-color: #bb8fce;
        }
        .position.no-rest .pos-label { color: #e8daef; }
        .position.no-rest .player-name { color: #fff; }
        
        /* Afwezig toggle */
        .absent-section {
            background: rgba(231,76,60,0.1);
            border: 1px solid rgba(231,76,60,0.2);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 12px;
        }
        .absent-title {
            font-size: 0.75em;
            color: #e74c3c;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .absent-players {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .absent-toggle {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.08);
            color: rgba(255,255,255,0.8);
            transition: all 0.2s;
        }
        .absent-toggle.absent {
            background: rgba(231,76,60,0.3);
            border-color: #e74c3c;
            color: #ff6b6b;
            text-decoration: line-through;
        }
        
        .bench {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 10px;
            margin-top: 12px;
            border: 1px solid rgba(255,215,0,0.2);
        }
        .bench-title {
            font-size: 0.75em;
            color: #FFD700;
            margin-bottom: 6px;
            font-weight: 600;
        }
        .bench-players {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        .bench-player {
            background: rgba(255,215,0,0.1);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            border: 1px solid rgba(255,215,0,0.3);
            font-weight: 500;
        }
        .bench-player.warning {
            background: rgba(231,76,60,0.25);
            border-color: #e74c3c;
            color: #ff6b6b;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .bench-warning {
            font-size: 0.7em;
            color: #e74c3c;
            margin-top: 6px;
            padding: 4px 8px;
            background: rgba(231,76,60,0.15);
            border-radius: 4px;
        }
        
        /* 8v8 MIX SELECTIE */
        .mix-section {
            background: rgba(155,89,182,0.1);
            border: 1px solid rgba(155,89,182,0.3);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
        }
        .mix-title {
            font-size: 0.8em;
            color: #bb8fce;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .mix-players {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .mix-player {
            padding: 6px 10px;
            background: rgba(255,255,255,0.08);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 6px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.2s;
        }
        .mix-player.selected {
            border-color: #9b59b6;
            background: rgba(155,89,182,0.2);
            color: #bb8fce;
        }
        .mix-count {
            font-size: 0.7em;
            color: rgba(255,255,255,0.6);
            margin-top: 8px;
        }
        
        /* SCORE */
        .score-display {
            background: rgba(0,0,0,0.25);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            text-align: center;
            border: 1px solid rgba(255,215,0,0.2);
        }
        .score-teams {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }
        .score-num {
            font-size: 2em;
            font-weight: 700;
            color: #FFD700;
        }
        .team-name-score { font-size: 0.8em; max-width: 70px; color: rgba(255,255,255,0.8); }
        
        .player-select {
            width: 100%;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 8px;
            color: white;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .note-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 12px;
        }
        .note-btn {
            padding: 10px 6px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            font-weight: 600;
            font-size: 0.7em;
            transition: transform 0.15s;
        }
        .note-btn:active { transform: scale(0.95); }
        .note-btn.goal { background: linear-gradient(135deg, #27ae60, #1e8449); color: white; }
        .note-btn.assist { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .note-btn.good { background: linear-gradient(135deg, #FFD700, #e6c200); color: #003380; }
        .note-btn.improve { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; }
        .note-btn.injury { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .note-btn.other { background: linear-gradient(135deg, #7f8c8d, #6c7a7b); color: white; }
        .note-btn .icon { font-size: 1.3em; }
        
        .opponent-goal-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #c0392b, #a93226);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            font-size: 0.85em;
            margin-bottom: 12px;
            cursor: pointer;
        }
        
        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 250px;
            overflow-y: auto;
        }
        .note-item {
            background: rgba(0,0,0,0.2);
            padding: 8px 10px;
            border-radius: 6px;
            border-left: 3px solid #FFD700;
            font-size: 0.8em;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
        }
        .note-item .note-content { flex: 1; }
        .note-item .note-delete {
            background: rgba(231,76,60,0.3);
            border: none;
            color: #e74c3c;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            flex-shrink: 0;
        }
        .note-item.goal { border-left-color: #27ae60; }
        .note-item.assist { border-left-color: #3498db; }
        .note-item.opponent_goal { border-left-color: #e74c3c; }
        
        .clear-btns {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        .clear-btn {
            flex: 1;
            padding: 8px;
            background: rgba(231,76,60,0.15);
            border: 1px solid rgba(231,76,60,0.3);
            border-radius: 6px;
            color: #e74c3c;
            font-size: 0.75em;
            font-weight: 600;
            cursor: pointer;
        }
        .clear-btn:active { background: rgba(231,76,60,0.25); }
        
        .share-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #FFD700 0%, #e6c200 100%);
            border: none;
            border-radius: 8px;
            color: #003380;
            font-weight: 700;
            font-size: 0.9em;
            cursor: pointer;
            margin-top: 12px;
        }
        
        /* INFO CARDS */
        .info-card {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,215,0,0.15);
        }
        .info-card h3 { color: #FFD700; margin-bottom: 8px; font-size: 0.9em; }
        .info-row { display: flex; justify-content: space-between; margin: 4px 0; font-size: 0.85em; }
        .info-label { color: rgba(255,255,255,0.6); }
        .info-value { color: #FFD700; font-weight: 600; }
        
        /* MODALS */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: linear-gradient(180deg, #0047AB, #003380);
            border-radius: 12px;
            padding: 15px;
            width: 100%;
            max-width: 320px;
            max-height: 70vh;
            overflow-y: auto;
            border: 2px solid #FFD700;
        }
        .modal-title {
            font-size: 0.95em;
            margin-bottom: 10px;
            color: #FFD700;
            font-weight: 600;
        }
        .modal-players {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .modal-player {
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9em;
            transition: background 0.15s;
        }
        .modal-player:active { background: rgba(255,215,0,0.2); }
        .modal-close {
            margin-top: 10px;
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }
        .modal textarea {
            width: 100%;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 6px;
            color: white;
            min-height: 70px;
            margin-bottom: 8px;
            font-family: inherit;
        }
        .modal-confirm {
            width: 100%;
            padding: 10px;
            background: #FFD700;
            border: none;
            border-radius: 6px;
            color: #003380;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 6px;
        }
        
        @media (display-mode: standalone) {
            body { padding-top: env(safe-area-inset-top); }
        }
        
        /* DESKTOP VERSION */
        @media (min-width: 768px) {
            body { font-size: 16px; }
            
            .header {
                padding: 16px 30px;
            }
            .header-logo { width: 48px; height: 48px; font-size: 22px; }
            .header-text h1 { font-size: 1.2em; }
            .header-text p { font-size: 0.85em; }
            
            .team-select {
                padding: 16px 30px;
                gap: 12px;
            }
            .team-btn {
                padding: 12px 24px;
                font-size: 0.95em;
                border-radius: 25px;
            }
            
            .opponent-bar {
                padding: 12px 30px;
                font-size: 1em;
                max-width: 800px;
                margin: 0 auto;
            }
            .opponent-bar input {
                padding: 10px 16px;
                font-size: 1em;
            }
            
            .tabs {
                max-width: 800px;
                margin: 0 auto;
            }
            .tab {
                padding: 14px 12px;
                font-size: 0.95em;
            }
            
            .content {
                padding: 24px;
                max-width: 800px;
            }
            
            .quarter-tabs {
                gap: 12px;
                margin-bottom: 20px;
            }
            .quarter-tab {
                padding: 14px;
                font-size: 1em;
                border-radius: 10px;
            }
            
            .auto-btn {
                padding: 14px;
                font-size: 1em;
            }
            
            .formation-selector {
                gap: 10px;
                margin-bottom: 20px;
            }
            .formation-btn {
                padding: 10px 20px;
                font-size: 0.9em;
            }
            
            .field {
                min-height: 400px;
                padding: 24px 16px;
                border-radius: 16px;
            }
            
            .position-row {
                padding: 0 30px;
                margin: 12px 0;
            }
            .position-row.attack { margin-top: 20px; }
            .position-row.midfield { margin: 50px 0; }
            .position-row.defense { margin-bottom: 15px; }
            .position-row.keeper { margin-top: 35px; }
            
            .position {
                min-width: 90px;
                padding: 12px 8px;
                border-radius: 12px;
                border-width: 3px;
            }
            .position .pos-label { font-size: 0.7em; }
            .position .player-name { font-size: 0.9em; margin-top: 4px; }
            
            .bench {
                padding: 16px;
                margin-top: 20px;
                border-radius: 12px;
            }
            .bench-title { font-size: 0.9em; margin-bottom: 10px; }
            .bench-players { gap: 10px; }
            .bench-player {
                padding: 8px 16px;
                font-size: 0.9em;
                border-radius: 20px;
            }
            
            .share-btn {
                padding: 16px;
                font-size: 1.1em;
                border-radius: 12px;
                margin-top: 20px;
            }
            
            .score-display {
                padding: 20px;
                border-radius: 16px;
                margin-bottom: 20px;
            }
            .score-num { font-size: 3em; }
            .team-name-score { font-size: 1em; max-width: 120px; }
            
            .player-select {
                padding: 14px;
                font-size: 1em;
                margin-bottom: 16px;
            }
            
            .note-buttons {
                gap: 12px;
                margin-bottom: 20px;
            }
            .note-btn {
                padding: 16px 10px;
                font-size: 0.9em;
                border-radius: 12px;
            }
            .note-btn .icon { font-size: 1.6em; }
            
            .opponent-goal-btn {
                padding: 14px;
                font-size: 1em;
                border-radius: 10px;
            }
            
            .notes-list {
                gap: 10px;
                max-height: 350px;
            }
            .note-item {
                padding: 14px 16px;
                font-size: 0.95em;
                border-radius: 10px;
            }
            
            .clear-btns { gap: 12px; margin-top: 20px; }
            .clear-btn { padding: 12px; font-size: 0.9em; }
            
            .info-card {
                padding: 20px;
                margin-bottom: 16px;
                border-radius: 12px;
            }
            .info-card h3 { font-size: 1.1em; margin-bottom: 12px; }
            .info-row { font-size: 1em; margin: 8px 0; }
            
            .mix-section {
                padding: 20px;
                margin-bottom: 20px;
                border-radius: 12px;
            }
            .mix-title { font-size: 1em; margin-bottom: 12px; }
            .mix-player { padding: 10px 16px; font-size: 0.9em; }
            .mix-count { font-size: 0.85em; margin-top: 12px; }
            
            .modal-content {
                max-width: 450px;
                padding: 24px;
                border-radius: 16px;
            }
            .modal-title { font-size: 1.2em; margin-bottom: 16px; }
            .modal-player { padding: 14px; font-size: 1em; border-radius: 10px; }
            .modal-close { padding: 14px; font-size: 1em; }
            .modal textarea { padding: 14px; min-height: 100px; font-size: 1em; }
            .modal-confirm { padding: 14px; font-size: 1em; }
        }
        
        /* LARGE DESKTOP - Zelfde opbouw als mobiel, maar groter */
        @media (min-width: 1200px) {
            .content { max-width: 650px; }
            
            .absent-section { padding: 12px 16px; }
            .absent-title { font-size: 0.8em; margin-bottom: 10px; }
            .absent-players { 
                flex-direction: row !important;
                flex-wrap: wrap;
                gap: 8px;
            }
            .absent-toggle { padding: 6px 14px; font-size: 0.8em; }
            
            .quarter-tabs { max-width: 500px; margin: 0 auto 16px; }
            
            .field { 
                min-height: 380px;
                max-width: 550px;
                margin: 0 auto;
            }
            
            .position { min-width: 80px; padding: 10px 8px; }
            .position .player-name { font-size: 0.9em; }
            
            /* Spelers meer verspreid */
            .position-row.attack { margin-top: 16px; padding: 0 60px; }
            .position-row.midfield { margin: 45px 0; padding: 0 20px; }
            .position-row.defense { margin-bottom: 12px; padding: 0 50px; }
            .position-row.keeper { margin-top: 25px; }
            
            .bench { max-width: 550px; margin: 16px auto 0; }
            .share-btn { max-width: 550px; margin: 16px auto 0; display: block; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-logo">‚öΩ</div>
        <div class="header-text">
            <h1>VV Hooglanderveen Trainer</h1>
            <p>JO10 ‚Ä¢ Seizoen 25-26</p>
        </div>
        <div class="sync-status" id="syncStatus">Offline</div>
    </div>
    
    <div class="team-select">
        <button class="team-btn active" data-team="jo10-1" onclick="selectTeam('jo10-1')">JO10-1</button>
        <button class="team-btn" data-team="jo10-2" onclick="selectTeam('jo10-2')">JO10-2</button>
        <button class="team-btn" data-team="jo10-3" onclick="selectTeam('jo10-3')">JO10-3</button>
        <button class="team-btn mix" data-team="mix" onclick="selectTeam('mix')">‚ö° 8v8</button>
    </div>
    
    <div class="opponent-bar">
        <label>vs</label>
        <input type="text" id="opponentInput" placeholder="Tegenstander..." onchange="updateOpponent()">
    </div>
    
    <div class="tabs">
        <div class="tab active" data-tab="opstelling">üìã Opstelling</div>
        <div class="tab" data-tab="notities">üìù Notities</div>
        <div class="tab" data-tab="info">‚ÑπÔ∏è Info</div>
    </div>
    
    <!-- OPSTELLING -->
    <div class="content active" id="opstelling">
        <div class="quarter-tabs">
            <div class="quarter-tab active" data-quarter="1">K1</div>
            <div class="quarter-tab" data-quarter="2">K2</div>
            <div class="quarter-tab" data-quarter="3">K3</div>
            <div class="quarter-tab" data-quarter="4">K4</div>
        </div>
        
        <!-- Afwezig markeren -->
        <div class="absent-section">
            <div class="absent-title">üè• Afwezig (tik om te wisselen)</div>
            <div class="absent-players" id="absentPlayers"></div>
        </div>
        
        <!-- Auto opstelling knoppen -->
        <div style="display:flex;gap:8px;margin-bottom:12px;justify-content:flex-end;">
            <button class="auto-btn" onclick="autoFillLineup()">üîÑ Auto</button>
            <button class="auto-btn reset" onclick="resetLineup()">‚Ü©Ô∏è Reset</button>
        </div>
        
        <!-- Formatie selector (alleen bij 8v8) -->
        <div class="formation-selector" id="formationSelector" style="display:none;">
            <button class="formation-btn active" data-formation="2-3-2">2-3-2</button>
            <button class="formation-btn" data-formation="3-2-2">3-2-2</button>
            <button class="formation-btn" data-formation="2-4-1">2-4-1</button>
            <button class="formation-btn" data-formation="3-3-1">3-3-1</button>
        </div>
        
        <!-- Mix selectie (alleen bij 8v8) -->
        <div class="mix-section" id="mixSection" style="display:none;">
            <div class="mix-title">üë• Selecteer spelers (max 10)</div>
            <div class="mix-players" id="mixPlayers"></div>
            <div class="mix-count" id="mixCount">0/10 geselecteerd</div>
        </div>
        
        <div class="field" id="fieldContainer"></div>
        
        <div class="bench">
            <div class="bench-title">ü™ë Wissel:</div>
            <div class="bench-players" id="benchPlayers"></div>
        </div>
        
        <button class="share-btn" onclick="shareLineup()">üì§ Deel opstelling</button>
    </div>
    
    <!-- NOTITIES -->
    <div class="content" id="notities">
        <div class="score-display">
            <div class="score-teams">
                <span class="team-name-score" id="homeTeam">VVH</span>
                <span class="score-num" id="scoreHome">0</span>
                <span style="opacity:0.5">-</span>
                <span class="score-num" id="scoreAway">0</span>
                <span class="team-name-score" id="awayTeam">TEG</span>
            </div>
        </div>
        
        <select class="player-select" id="notePlayer">
            <option value="">-- Speler --</option>
        </select>
        
        <div class="note-buttons">
            <button class="note-btn goal" onclick="addNote('goal')"><span class="icon">‚öΩ</span>Goal</button>
            <button class="note-btn assist" onclick="addNote('assist')"><span class="icon">üëü</span>Assist</button>
            <button class="note-btn good" onclick="addNote('good')"><span class="icon">‚≠ê</span>Goed</button>
            <button class="note-btn improve" onclick="addNote('improve')"><span class="icon">üìà</span>Beter</button>
            <button class="note-btn injury" onclick="addNote('injury')"><span class="icon">üè•</span>Blessure</button>
            <button class="note-btn other" onclick="addNote('other')"><span class="icon">üìù</span>Anders</button>
        </div>
        
        <button class="opponent-goal-btn" onclick="addOpponentGoal()">ü•Ö Tegendoelpunt</button>
        
        <div class="notes-list" id="notesList"></div>
        
        <div class="clear-btns">
            <button class="clear-btn" onclick="clearAllNotes()">üóëÔ∏è Wis alle notities</button>
            <button class="clear-btn" onclick="resetScore()">‚Ü©Ô∏è Reset score</button>
        </div>
    </div>
    
    <!-- INFO -->
    <div class="content" id="info">
        <div class="info-card">
            <h3>üìã Wedstrijd</h3>
            <div class="info-row"><span class="info-label">Tegenstander:</span><span class="info-value" id="infoOpponent">-</span></div>
            <div class="info-row"><span class="info-label">Formatie:</span><span class="info-value" id="infoFormation">1-2-1-2</span></div>
        </div>
        <div class="info-card">
            <h3>üë• Team</h3>
            <div class="info-row"><span class="info-label">Team:</span><span class="info-value" id="infoTeamName">-</span></div>
            <div class="info-row"><span class="info-label">Trainer:</span><span class="info-value" id="infoTrainer">-</span></div>
            <div class="info-row"><span class="info-label">Manager:</span><span class="info-value" id="infoManager">-</span></div>
            <div class="info-row"><span class="info-label">Spelers:</span><span class="info-value" id="infoPlayers">-</span></div>
        </div>
    </div>
    
    <div class="toast" id="toast">‚úì Opgeslagen</div>
    
    <!-- MODALS -->
    <div class="modal" id="playerModal">
        <div class="modal-content">
            <div class="modal-title">Selecteer voor <span id="modalPosition"></span></div>
            <div class="modal-players" id="modalPlayers"></div>
            <button class="modal-close" onclick="closeModal()">Annuleren</button>
        </div>
    </div>
    
    <div class="modal" id="noteModal">
        <div class="modal-content">
            <div class="modal-title" id="noteModalTitle">Notitie</div>
            <textarea id="noteText" placeholder="Toelichting..."></textarea>
            <button class="modal-confirm" onclick="confirmNote()">‚úì Opslaan</button>
            <button class="modal-close" onclick="closeNoteModal()">Annuleren</button>
        </div>
    </div>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyD7xLl7h6k7Z0xHnA1v1c1pMN0V2L3L4M8",
            authDomain: "jo10-14d44.firebaseapp.com",
            databaseURL: "https://jo10-14d44-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "jo10-14d44",
            storageBucket: "jo10-14d44.firebasestorage.app"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // Team data
        const teams = {
            'jo10-1': {
                naam: 'JO10-1', klasse: 'Hoofdklasse W1B3', trainer: 'Eric', manager: 'Dominique & Mark',
                spelers: ['Mees V.', 'Liam', 'Jairo', 'Yaer', 'Jeftha', 'Mees R.', 'Philine', 'Xander']
            },
            'jo10-2': {
                naam: 'JO10-2', klasse: 'Hoofdklasse W1B5', trainer: 'Ryan', manager: 'Stefan',
                spelers: ['Fedde', 'Tian', 'Vince', 'Dex', 'Mees L.', 'James', 'Mert', 'Teije']
            },
            'jo10-3': {
                naam: 'JO10-3', klasse: '1e Klasse 12', trainer: 'Gigi & Niels', manager: 'Hassan',
                spelers: ['Younes', 'Zayn', 'Siem', 'Freek', 'Morris', 'Seb', 'Job', 'Maud']
            },
            'mix': {
                naam: '8v8 Mix', klasse: 'Vrije selectie', trainer: '-', manager: '-',
                spelers: []
            }
        };
        
        const allPlayers = [...teams['jo10-1'].spelers, ...teams['jo10-2'].spelers, ...teams['jo10-3'].spelers];
        
        // Formaties
        const formations = {
            '1-2-1-2': {
                positions: ['K', 'LV', 'RV', 'M', 'LA', 'RA'],
                layout: { attack: ['LA', 'RA'], midfield: ['M'], defense: ['LV', 'RV'], keeper: ['K'] }
            },
            '2-3-2': {
                positions: ['K', 'LV', 'RV', 'LM', 'CM', 'RM', 'LA', 'RA'],
                layout: { attack: ['LA', 'RA'], midfield: ['LM', 'CM', 'RM'], defense: ['LV', 'RV'], keeper: ['K'] }
            },
            '3-2-2': {
                positions: ['K', 'LV', 'CV', 'RV', 'LM', 'RM', 'LA', 'RA'],
                layout: { attack: ['LA', 'RA'], midfield: ['LM', 'RM'], defense: ['LV', 'CV', 'RV'], keeper: ['K'] }
            },
            '2-4-1': {
                positions: ['K', 'LV', 'RV', 'LM', 'LCM', 'RCM', 'RM', 'SP'],
                layout: { attack: ['SP'], midfield: ['LM', 'LCM', 'RCM', 'RM'], defense: ['LV', 'RV'], keeper: ['K'] }
            },
            '3-3-1': {
                positions: ['K', 'LV', 'CV', 'RV', 'LM', 'CM', 'RM', 'SP'],
                layout: { attack: ['SP'], midfield: ['LM', 'CM', 'RM'], defense: ['LV', 'CV', 'RV'], keeper: ['K'] }
            }
        };
        
        let currentTeam = 'jo10-1';
        let currentQuarter = 1;
        let currentFormation = '1-2-1-2';
        let selectedPosition = null;
        let pendingNote = null;
        let mixSelected = JSON.parse(localStorage.getItem('jo10_mix_selected') || '[]');
        let firebaseConnected = false;
        
        // Afwezige spelers per team
        function getAbsent() { return getData('absent', []); }
        function setAbsent(data) { setData('absent', data); }
        
        function getAvailablePlayers() {
            const team = teams[currentTeam];
            const absent = getAbsent();
            return team.spelers.filter(p => !absent.includes(p));
        }
        
        // Firebase paths
        function fbPath(suffix) { return `trainer/${currentTeam}/${suffix}`; }
        
        // Data functions with Firebase sync
        function getData(key, defaultVal) {
            return JSON.parse(localStorage.getItem(`jo10trainer_${currentTeam}_${key}`) || JSON.stringify(defaultVal));
        }
        
        function setData(key, data) {
            try {
                localStorage.setItem(`jo10trainer_${currentTeam}_${key}`, JSON.stringify(data));
                showToast('‚úì Opgeslagen');
            } catch (e) {
                showToast('‚ö†Ô∏è Opslaan mislukt (private mode?)');
                console.error('localStorage error:', e);
            }
            // Sync to Firebase
            if (firebaseConnected) {
                db.ref(fbPath(key)).set(data).catch(e => console.log('Firebase sync error:', e));
            }
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('show');
            void toast.offsetWidth; // Force reflow
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        function getLineup() { return getData('lineup', createEmptyLineup()); }
        function setLineup(data) { setData('lineup', data); }
        function getNotes() { return getData('notes', []); }
        function setNotes(data) { setData('notes', data); }
        function getMatch() { return getData('match', { opponent: '', scoreHome: 0, scoreAway: 0 }); }
        function setMatch(data) { setData('match', data); }
        
        function createEmptyLineup() {
            const f = formations[currentFormation];
            const empty = {};
            f.positions.forEach(p => empty[p] = '');
            return { 1: {...empty}, 2: {...empty}, 3: {...empty}, 4: {...empty} };
        }
        
        // Firebase connection
        db.ref('.info/connected').on('value', snap => {
            firebaseConnected = snap.val() === true;
            document.getElementById('syncStatus').textContent = firebaseConnected ? '‚òÅÔ∏è Sync' : 'Offline';
            document.getElementById('syncStatus').className = 'sync-status' + (firebaseConnected ? ' online' : '');
        });
        
        // Listen for Firebase changes
        function setupFirebaseListeners() {
            db.ref(fbPath('lineup')).on('value', snap => {
                if (snap.val()) {
                    localStorage.setItem(`jo10trainer_${currentTeam}_lineup`, JSON.stringify(snap.val()));
                    renderLineup();
                }
            });
            db.ref(fbPath('match')).on('value', snap => {
                if (snap.val()) {
                    localStorage.setItem(`jo10trainer_${currentTeam}_match`, JSON.stringify(snap.val()));
                    updateMatchDisplay();
                }
            });
            db.ref(fbPath('notes')).on('value', snap => {
                if (snap.val()) {
                    localStorage.setItem(`jo10trainer_${currentTeam}_notes`, JSON.stringify(snap.val()));
                    renderNotes();
                }
            });
        }
        
        function updateMatchDisplay() {
            const match = getMatch();
            document.getElementById('opponentInput').value = match.opponent || '';
            document.getElementById('scoreHome').textContent = match.scoreHome || 0;
            document.getElementById('scoreAway').textContent = match.scoreAway || 0;
            document.getElementById('awayTeam').textContent = (match.opponent || 'TEG').split(' ')[0].substring(0, 6);
            document.getElementById('infoOpponent').textContent = match.opponent || '-';
        }
        
        // AUTO OPSTELLING
        function autoFillLineup() {
            const f = formations[currentFormation];
            const lineup = getLineup();
            const available = getAvailablePlayers();
            
            // Shuffle beschikbare spelers
            const shuffled = [...available].sort(() => Math.random() - 0.5);
            
            // Vul posities voor dit kwart
            const quarterLineup = {};
            f.positions.forEach((pos, i) => {
                quarterLineup[pos] = shuffled[i] || '';
            });
            
            lineup[currentQuarter] = quarterLineup;
            setLineup(lineup);
            renderLineup();
        }
        
        function selectTeam(teamId) {
            currentTeam = teamId;
            document.querySelectorAll('.team-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-team="${teamId}"]`).classList.add('active');
            
            const isMix = teamId === 'mix';
            document.getElementById('formationSelector').style.display = isMix ? 'flex' : 'none';
            document.getElementById('mixSection').style.display = isMix ? 'block' : 'none';
            
            if (isMix) {
                currentFormation = localStorage.getItem('jo10_mix_formation') || '2-3-2';
                updateFormationButtons();
                renderMixPlayers();
                teams.mix.spelers = mixSelected;
            } else {
                currentFormation = '1-2-1-2';
            }
            
            setupFirebaseListeners();
            updateUI();
        }
        
        function updateFormationButtons() {
            document.querySelectorAll('.formation-btn').forEach(b => {
                b.classList.toggle('active', b.dataset.formation === currentFormation);
            });
        }
        
        function renderMixPlayers() {
            const container = document.getElementById('mixPlayers');
            container.innerHTML = allPlayers.map(p => {
                const selected = mixSelected.includes(p);
                return `<div class="mix-player ${selected ? 'selected' : ''}" onclick="toggleMixPlayer('${p}')">${p}</div>`;
            }).join('');
            document.getElementById('mixCount').textContent = `${mixSelected.length}/10 geselecteerd`;
        }
        
        function toggleMixPlayer(name) {
            if (mixSelected.includes(name)) {
                mixSelected = mixSelected.filter(p => p !== name);
            } else if (mixSelected.length < 10) {
                mixSelected.push(name);
            }
            localStorage.setItem('jo10_mix_selected', JSON.stringify(mixSelected));
            teams.mix.spelers = mixSelected;
            renderMixPlayers();
            renderLineup();
        }
        
        function updateOpponent() {
            const match = getMatch();
            match.opponent = document.getElementById('opponentInput').value;
            setMatch(match);
            updateMatchDisplay();
        }
        
        function updateUI() {
            const team = teams[currentTeam];
            const match = getMatch();
            
            updateMatchDisplay();
            document.getElementById('homeTeam').textContent = team.naam;
            document.getElementById('infoTeamName').textContent = team.naam;
            document.getElementById('infoTrainer').textContent = team.trainer;
            document.getElementById('infoManager').textContent = team.manager;
            document.getElementById('infoPlayers').textContent = team.spelers.length;
            document.getElementById('infoFormation').textContent = currentFormation;
            
            const select = document.getElementById('notePlayer');
            const availableForNotes = getAvailablePlayers();
            select.innerHTML = '<option value="">-- Speler --</option>' +
                availableForNotes.map(p => `<option value="${p}">${p}</option>`).join('');
            
            renderField();
            renderLineup();
            renderNotes();
        }
        
        function renderField() {
            const f = formations[currentFormation];
            const container = document.getElementById('fieldContainer');
            
            let html = '';
            ['attack', 'midfield', 'defense', 'keeper'].forEach(row => {
                const positions = f.layout[row];
                if (positions.length > 0) {
                    html += `<div class="position-row ${row}">`;
                    positions.forEach(pos => {
                        const isKeeper = pos === 'K';
                        html += `
                            <div class="position ${isKeeper ? 'keeper' : ''}" onclick="selectPosition('${pos}')">
                                <div class="pos-label">${pos}</div>
                                <div class="player-name" id="pos-${pos}">-</div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
            });
            
            container.innerHTML = html;
        }
        
        function renderLineup() {
            const lineup = getLineup();
            const q = lineup[currentQuarter] || {};
            const team = teams[currentTeam];
            const f = formations[currentFormation];
            const absent = getAbsent();
            const available = getAvailablePlayers();
            
            // Check which players play ALL 4 quarters (no rest)
            const playersInAllQuarters = available.filter(player => {
                for (let quarter = 1; quarter <= 4; quarter++) {
                    const qLineup = lineup[quarter] || {};
                    const onFieldInQ = Object.values(qLineup).filter(p => p);
                    if (!onFieldInQ.includes(player)) return false;
                }
                return true;
            });
            
            f.positions.forEach(pos => {
                const el = document.getElementById(`pos-${pos}`);
                const playerName = q[pos] || '-';
                if (el) el.textContent = playerName;
                
                // Mark purple if player plays ALL 4 quarters
                const posEl = el?.closest('.position');
                if (posEl) {
                    const noRest = playerName !== '-' && playersInAllQuarters.includes(playerName);
                    posEl.classList.toggle('no-rest', noRest);
                }
            });
            
            const onField = Object.values(q).filter(p => p);
            const bench = available.filter(p => !onField.includes(p));
            
            // For warning: check linked quarter
            const linkedQuarter = currentQuarter === 1 ? 2 : (currentQuarter === 2 ? 1 : (currentQuarter === 3 ? 4 : 3));
            const linkedLineup = lineup[linkedQuarter] || {};
            const linkedOnField = Object.values(linkedLineup).filter(p => p);
            const linkedBench = available.filter(p => !linkedOnField.includes(p));
            
            // Players on bench in both linked quarters = warning
            const doubleBench = bench.filter(p => linkedBench.includes(p));
            
            let benchHtml = '';
            if (bench.length > 0) {
                benchHtml = bench.map(p => {
                    const isWarning = doubleBench.includes(p);
                    return `<div class="bench-player ${isWarning ? 'warning' : ''}">${p}${isWarning ? ' ‚ö†Ô∏è' : ''}</div>`;
                }).join('');
                
                if (doubleBench.length > 0) {
                    const linkedLabel = linkedQuarter < currentQuarter ? `K${linkedQuarter}` : `K${linkedQuarter}`;
                    benchHtml += `<div class="bench-warning">‚ö†Ô∏è ${doubleBench.join(', ')} staat ook wissel in K${linkedQuarter}!</div>`;
                }
            } else {
                benchHtml = '<span style="color:rgba(255,255,255,0.4);font-size:0.8em;">Iedereen op veld</span>';
            }
            
            document.getElementById('benchPlayers').innerHTML = benchHtml;
            
            // Render absent toggles
            renderAbsentPlayers();
        }
        
        function renderAbsentPlayers() {
            const team = teams[currentTeam];
            const absent = getAbsent();
            
            document.getElementById('absentPlayers').innerHTML = team.spelers.map(p => {
                const isAbsent = absent.includes(p);
                return `<div class="absent-toggle ${isAbsent ? 'absent' : ''}" onclick="toggleAbsent('${p}')">${p}</div>`;
            }).join('');
        }
        
        function toggleAbsent(player) {
            let absent = getAbsent();
            if (absent.includes(player)) {
                absent = absent.filter(p => p !== player);
            } else {
                absent.push(player);
                // Remove from lineup if absent
                const lineup = getLineup();
                for (let q = 1; q <= 4; q++) {
                    if (lineup[q]) {
                        for (let pos in lineup[q]) {
                            if (lineup[q][pos] === player) {
                                lineup[q][pos] = '';
                            }
                        }
                    }
                }
                setLineup(lineup);
            }
            setAbsent(absent);
            renderLineup();
        }
        
        function renderNotes() {
            const notes = getNotes();
            const icons = { goal:'‚öΩ', assist:'üëü', injury:'üè•', good:'‚≠ê', improve:'üìà', other:'üìù', opponent_goal:'ü•Ö' };
            document.getElementById('notesList').innerHTML = notes.map((n, i) => `
                <div class="note-item ${n.type}">
                    <div class="note-content">
                        <strong>${icons[n.type] || 'üìù'} ${n.player || ''}</strong> <small style="opacity:0.6">K${n.quarter} ${n.time}</small>
                        ${n.text ? `<br><span style="color:rgba(255,255,255,0.6)">${n.text}</span>` : ''}
                    </div>
                    <button class="note-delete" onclick="deleteNote(${i})">√ó</button>
                </div>
            `).join('') || '<p style="text-align:center;color:rgba(255,255,255,0.4);font-size:0.85em">Geen notities</p>';
        }
        
        function deleteNote(index) {
            const notes = getNotes();
            const note = notes[index];
            // Adjust score if deleting a goal
            if (note && note.type === 'goal') {
                const match = getMatch();
                match.scoreHome = Math.max(0, (match.scoreHome || 0) - 1);
                setMatch(match);
                document.getElementById('scoreHome').textContent = match.scoreHome;
            }
            if (note && note.type === 'opponent_goal') {
                const match = getMatch();
                match.scoreAway = Math.max(0, (match.scoreAway || 0) - 1);
                setMatch(match);
                document.getElementById('scoreAway').textContent = match.scoreAway;
            }
            notes.splice(index, 1);
            setNotes(notes);
            renderNotes();
        }
        
        function clearAllNotes() {
            if (confirm('Alle notities verwijderen?')) {
                setNotes([]);
                renderNotes();
            }
        }
        
        function resetScore() {
            if (confirm('Score resetten naar 0-0?')) {
                const match = getMatch();
                match.scoreHome = 0;
                match.scoreAway = 0;
                setMatch(match);
                document.getElementById('scoreHome').textContent = 0;
                document.getElementById('scoreAway').textContent = 0;
            }
        }
        
        function resetLineup() {
            if (confirm(`Opstelling K${currentQuarter} wissen?`)) {
                const lineup = getLineup();
                const f = formations[currentFormation];
                const empty = {};
                f.positions.forEach(p => empty[p] = '');
                lineup[currentQuarter] = empty;
                setLineup(lineup);
                renderLineup();
            }
        }
        
        // Quarter tabs with auto-copy logic
        document.querySelectorAll('.quarter-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.quarter-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentQuarter = parseInt(tab.dataset.quarter);
                
                // Auto-copy: K1‚ÜíK2, K3‚ÜíK4 if target is empty
                const lineup = getLineup();
                const sourceQuarter = currentQuarter === 2 ? 1 : (currentQuarter === 4 ? 3 : null);
                
                if (sourceQuarter) {
                    const targetLineup = lineup[currentQuarter] || {};
                    const isEmpty = Object.values(targetLineup).every(v => !v);
                    
                    if (isEmpty && lineup[sourceQuarter]) {
                        lineup[currentQuarter] = {...lineup[sourceQuarter]};
                        setLineup(lineup);
                    }
                }
                
                renderLineup();
            });
        });
        
        // Main tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });
        
        // Formation buttons
        document.querySelectorAll('.formation-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentFormation = btn.dataset.formation;
                localStorage.setItem('jo10_mix_formation', currentFormation);
                updateFormationButtons();
                renderField();
                const lineup = createEmptyLineup();
                setLineup(lineup);
                renderLineup();
                document.getElementById('infoFormation').textContent = currentFormation;
            });
        });
        
        function selectPosition(pos) {
            selectedPosition = pos;
            document.getElementById('modalPosition').textContent = pos;
            
            const lineup = getLineup();
            const currentPlayers = Object.values(lineup[currentQuarter] || {});
            const availablePlayers = getAvailablePlayers();
            const available = availablePlayers.filter(p => !currentPlayers.includes(p) || lineup[currentQuarter][pos] === p);
            
            document.getElementById('modalPlayers').innerHTML = `
                <div class="modal-player" onclick="assignPlayer('')">- Leeg -</div>
                ${available.map(p => `<div class="modal-player" onclick="assignPlayer('${p}')">${p}</div>`).join('')}
            `;
            document.getElementById('playerModal').classList.add('active');
        }
        
        function assignPlayer(name) {
            const lineup = getLineup();
            if (!lineup[currentQuarter]) lineup[currentQuarter] = {};
            lineup[currentQuarter][selectedPosition] = name;
            setLineup(lineup);
            renderLineup();
            closeModal();
        }
        
        function closeModal() { document.getElementById('playerModal').classList.remove('active'); }
        
        function addNote(type) {
            const player = document.getElementById('notePlayer').value;
            if (!player && type !== 'other') { alert('Selecteer eerst een speler'); return; }
            pendingNote = { type, player };
            const titles = { goal:'‚öΩ Goal', assist:'üëü Assist', injury:'üè• Blessure', good:'‚≠ê Goed moment', improve:'üìà Aandachtspunt', other:'üìù Notitie' };
            document.getElementById('noteModalTitle').textContent = titles[type] + (player ? ` - ${player}` : '');
            document.getElementById('noteText').value = '';
            document.getElementById('noteModal').classList.add('active');
        }
        
        function confirmNote() {
            const notes = getNotes();
            const note = {
                ...pendingNote,
                text: document.getElementById('noteText').value,
                time: new Date().toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' }),
                quarter: currentQuarter
            };
            notes.unshift(note);
            setNotes(notes);
            
            if (note.type === 'goal') {
                const match = getMatch();
                match.scoreHome = (match.scoreHome || 0) + 1;
                setMatch(match);
                document.getElementById('scoreHome').textContent = match.scoreHome;
            }
            
            renderNotes();
            closeNoteModal();
        }
        
        function addOpponentGoal() {
            const match = getMatch();
            match.scoreAway = (match.scoreAway || 0) + 1;
            setMatch(match);
            document.getElementById('scoreAway').textContent = match.scoreAway;
            
            const notes = getNotes();
            notes.unshift({
                type: 'opponent_goal', player: 'Tegenstander', text: '',
                time: new Date().toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' }),
                quarter: currentQuarter
            });
            setNotes(notes);
            renderNotes();
        }
        
        function closeNoteModal() { document.getElementById('noteModal').classList.remove('active'); }
        
        function shareLineup() {
            const team = teams[currentTeam];
            const match = getMatch();
            const lineup = getLineup();
            const available = getAvailablePlayers();
            
            // Voetbal volgorde: K=1, RV=2, LV=3, M=4, RA=5, LA=6
            const positionOrder = ['K', 'RV', 'LV', 'CV', 'M', 'RA', 'LA', 'RM', 'CM', 'LM', 'RCM', 'LCM', 'SP'];
            
            let text = `‚öΩ *${team.naam} vs ${match.opponent || '?'}*\n`;
            text += `üìä Formatie: ${currentFormation}\n`;
            
            for (let q = 1; q <= 4; q++) {
                const l = lineup[q] || {};
                // Sort by football position order
                const sortedEntries = Object.entries(l)
                    .filter(([k,v]) => v)
                    .sort((a, b) => positionOrder.indexOf(a[0]) - positionOrder.indexOf(b[0]));
                const players = sortedEntries.map(([k,v]) => `${k}:${v}`).join(' | ');
                const onField = Object.values(l).filter(p => p);
                const bench = available.filter(p => !onField.includes(p));
                text += `\nüìã K${q}: ${players || '-'}\n`;
                if (bench.length) text += `   ü™ë ${bench.join(', ')}\n`;
            }
            
            if (navigator.share) {
                navigator.share({ title: `${team.naam} Opstelling`, text });
            } else {
                navigator.clipboard.writeText(text);
                alert('Gekopieerd naar klembord!');
            }
        }
        
        // Init
        setupFirebaseListeners();
        updateUI();
        
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {});
        }
    </script>
</body>
</html>
