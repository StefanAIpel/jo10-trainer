<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#003087">
    <title>JO10 Trainer</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #003087 0%, #001a4d 100%);
            color: #fff; 
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #003087 0%, #002266 100%);
            padding: 12px 15px;
            text-align: center;
            border-bottom: 4px solid #FFD700;
        }
        .header h1 { font-size: 1.1em; color: #FFD700; }
        .header .match-info { font-size: 0.9em; color: #fff; margin-top: 4px; font-weight: bold; }
        
        /* Timer bar */
        .timer-bar {
            background: #001a4d;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #002266;
        }
        .timer-display {
            font-size: 1.8em;
            font-weight: bold;
            color: #FFD700;
            font-family: 'Courier New', monospace;
            min-width: 70px;
        }
        .timer-quarter {
            background: #FFD700;
            color: #003087;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .timer-quarter.ended {
            background: #dc3545;
            color: white;
        }
        .timer-btn {
            padding: 8px 14px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.85em;
        }
        .timer-btn.start {
            background: #28a745;
            color: white;
        }
        .timer-btn.stop {
            background: #ffc107;
            color: #003087;
        }
        .timer-btn.end-quarter {
            background: transparent;
            color: #dc3545;
            border: 2px solid #dc3545;
            margin-left: auto;
            font-size: 0.75em;
            padding: 6px 10px;
        }
        
        .team-select {
            display: flex;
            gap: 8px;
            padding: 10px;
            background: #002266;
            justify-content: center;
        }
        .team-btn {
            padding: 10px 16px;
            background: #003087;
            border: 2px solid #003087;
            border-radius: 8px;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }
        .team-btn.active {
            border-color: #FFD700;
            background: linear-gradient(135deg, #003087 0%, #004db3 100%);
            color: #FFD700;
        }
        
        .tabs {
            display: flex;
            background: #002266;
            border-bottom: 2px solid #FFD700;
        }
        .tab {
            flex: 1;
            padding: 12px 6px;
            text-align: center;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            color: rgba(255,255,255,0.7);
            border-bottom: 3px solid transparent;
        }
        .tab.active { 
            border-bottom-color: #FFD700; 
            color: #FFD700;
        }
        
        .content { padding: 12px; display: none; }
        .content.active { display: block; }
        
        .quarter-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }
        .quarter-tab {
            flex: 1;
            padding: 10px;
            background: #002266;
            border: 2px solid #003087;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            color: #fff;
        }
        .quarter-tab.active {
            border-color: #FFD700;
            color: #FFD700;
        }
        .quarter-tab.playing {
            border-color: #28a745;
            background: rgba(40,167,69,0.2);
        }
        
        .field {
            background: linear-gradient(to bottom, #228B22 0%, #1a6b1a 100%);
            border-radius: 12px;
            padding: 15px 10px;
            min-height: 360px;
            border: 3px solid #fff;
            position: relative;
        }
        .field::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 5%;
            right: 5%;
            height: 2px;
            background: rgba(255,255,255,0.4);
        }
        
        .position-row {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 10px 0;
            position: relative;
            z-index: 1;
        }
        .position {
            background: linear-gradient(135deg, #003087 0%, #004db3 100%);
            border: 3px solid #FFD700;
            border-radius: 10px;
            padding: 8px 6px;
            min-width: 68px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
        }
        .position.keeper { 
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-color: #003087;
        }
        .position .pos-label {
            font-size: 0.65em;
            color: #FFD700;
            font-weight: bold;
        }
        .position.keeper .pos-label { color: #003087; }
        .position .player-name {
            font-size: 0.85em;
            margin-top: 4px;
            font-weight: 600;
            color: #fff;
            min-height: 18px;
        }
        .position.keeper .player-name { color: #003087; }
        
        .bench {
            background: #002266;
            border-radius: 10px;
            padding: 12px;
            margin-top: 12px;
            border: 2px solid #003087;
        }
        .bench-title {
            font-size: 0.85em;
            color: #FFD700;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .bench-players {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .bench-player {
            background: #003087;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            border: 2px solid #FFD700;
            font-weight: 600;
        }
        
        .score-display {
            background: #002266;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
            border: 3px solid #FFD700;
        }
        .score-teams {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
        }
        .score-num {
            font-size: 2.2em;
            font-weight: bold;
            color: #FFD700;
        }
        .team-name { font-size: 0.85em; max-width: 70px; }
        
        .player-select, .quarter-select {
            width: 100%;
            padding: 12px;
            background: #001a4d;
            border: 2px solid #003087;
            border-radius: 8px;
            color: white;
            font-size: 1em;
            margin-bottom: 10px;
        }
        .time-inputs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        .time-inputs select, .time-inputs input {
            flex: 1;
            padding: 10px;
            background: #001a4d;
            border: 2px solid #003087;
            border-radius: 8px;
            color: white;
            font-size: 0.95em;
        }
        
        .note-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        .note-btn {
            padding: 12px 8px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-weight: 600;
            font-size: 0.8em;
        }
        .note-btn.goal { background: #28a745; color: white; }
        .note-btn.assist { background: #007bff; color: white; }
        .note-btn.injury { background: #dc3545; color: white; }
        .note-btn.good { background: #FFD700; color: #003087; }
        .note-btn.improve { background: #6f42c1; color: white; }
        .note-btn.sub { background: #17a2b8; color: white; }
        .note-btn .icon { font-size: 1.5em; }
        
        .opponent-goal-btn {
            width: 100%;
            padding: 12px;
            background: #dc3545;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            margin-bottom: 15px;
            cursor: pointer;
        }
        
        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 280px;
            overflow-y: auto;
        }
        .note-item {
            background: #002266;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #FFD700;
            font-size: 0.9em;
            position: relative;
        }
        .note-item.goal { border-left-color: #28a745; }
        .note-item.assist { border-left-color: #007bff; }
        .note-item.sub { border-left-color: #17a2b8; }
        .note-item.injury { border-left-color: #dc3545; }
        .note-item .note-time {
            font-size: 0.75em;
            color: #FFD700;
            margin-bottom: 2px;
        }
        .note-item .delete-note {
            position: absolute;
            right: 8px;
            top: 8px;
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 1em;
        }
        
        .share-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: none;
            border-radius: 10px;
            color: #003087;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .reset-btn {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 2px solid #dc3545;
            border-radius: 8px;
            color: #dc3545;
            font-weight: bold;
            font-size: 0.9em;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: #002266;
            border-radius: 12px;
            padding: 15px;
            width: 100%;
            max-width: 350px;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid #FFD700;
        }
        .modal-title {
            font-size: 1.1em;
            margin-bottom: 12px;
            color: #FFD700;
            font-weight: bold;
        }
        .modal-subtitle {
            font-size: 0.85em;
            color: rgba(255,255,255,0.7);
            margin-bottom: 10px;
        }
        .modal-players {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .modal-player {
            padding: 12px;
            background: #003087;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        .modal-player.selected {
            background: #28a745;
        }
        .modal-close {
            margin-top: 12px;
            width: 100%;
            padding: 12px;
            background: #dc3545;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        .modal textarea {
            width: 100%;
            padding: 12px;
            background: #001a4d;
            border: 2px solid #003087;
            border-radius: 8px;
            color: white;
            min-height: 60px;
            margin-bottom: 10px;
        }
        .modal select {
            width: 100%;
            padding: 10px;
            background: #001a4d;
            border: 2px solid #003087;
            border-radius: 8px;
            color: white;
            margin-bottom: 10px;
        }
        .modal-confirm {
            width: 100%;
            padding: 12px;
            background: #FFD700;
            border: none;
            border-radius: 8px;
            color: #003087;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 8px;
        }
        .modal-row {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        .modal-row select {
            flex: 1;
            margin-bottom: 0;
        }
        
        .info-card {
            background: #002266;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border: 2px solid #003087;
        }
        .info-card h3 { color: #FFD700; margin-bottom: 8px; font-size: 1em; }
        .info-row { display: flex; justify-content: space-between; margin: 5px 0; }
        .info-label { color: rgba(255,255,255,0.6); }
        .info-value { color: #FFD700; font-weight: 600; }
        
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #28a745;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            z-index: 300;
            display: none;
        }
        .toast.show { display: block; animation: fadeInOut 2s ease; }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            15%, 85% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚öΩ VV Hooglanderveen Trainer</h1>
        <div class="match-info" id="matchInfo">Selecteer team</div>
    </div>
    
    <!-- Timer Bar -->
    <div class="timer-bar">
        <div class="timer-display" id="timerDisplay">00:00</div>
        <div class="timer-quarter" id="timerQuarter">K1</div>
        <button class="timer-btn start" id="timerBtn" onclick="toggleTimer()">‚ñ∂ Start</button>
        <button class="timer-btn end-quarter" onclick="endQuarterPrompt()">‚èπ Einde K</button>
    </div>
    
    <div class="team-select">
        <button class="team-btn" data-team="jo10-1" onclick="selectTeam('jo10-1')">JO10-1</button>
        <button class="team-btn active" data-team="jo10-2" onclick="selectTeam('jo10-2')">JO10-2</button>
        <button class="team-btn" data-team="jo10-3" onclick="selectTeam('jo10-3')">JO10-3</button>
    </div>
    
    <div class="tabs">
        <div class="tab active" data-tab="opstelling">üìã Opstelling</div>
        <div class="tab" data-tab="notities">üìù Notities</div>
        <div class="tab" data-tab="verslag">üìä Verslag</div>
        <div class="tab" data-tab="info">‚ÑπÔ∏è Info</div>
    </div>
    
    <div class="content active" id="opstelling">
        <div class="quarter-tabs">
            <div class="quarter-tab active" data-quarter="1">K1</div>
            <div class="quarter-tab" data-quarter="2">K2</div>
            <div class="quarter-tab" data-quarter="3">K3</div>
            <div class="quarter-tab" data-quarter="4">K4</div>
        </div>
        
        <div class="field">
            <div class="position-row">
                <div class="position" onclick="selectPosition('LA')">
                    <div class="pos-label">LA</div>
                    <div class="player-name" id="pos-LA">-</div>
                </div>
                <div class="position" onclick="selectPosition('RA')">
                    <div class="pos-label">RA</div>
                    <div class="player-name" id="pos-RA">-</div>
                </div>
            </div>
            <div class="position-row" style="margin: 40px 0;">
                <div class="position" onclick="selectPosition('MV')">
                    <div class="pos-label">MV</div>
                    <div class="player-name" id="pos-MV">-</div>
                </div>
            </div>
            <div class="position-row">
                <div class="position" onclick="selectPosition('LV')">
                    <div class="pos-label">LV</div>
                    <div class="player-name" id="pos-LV">-</div>
                </div>
                <div class="position" onclick="selectPosition('RV')">
                    <div class="pos-label">RV</div>
                    <div class="player-name" id="pos-RV">-</div>
                </div>
            </div>
            <div class="position-row" style="margin-top: 30px;">
                <div class="position keeper" onclick="selectPosition('K')">
                    <div class="pos-label">KEEPER</div>
                    <div class="player-name" id="pos-K">-</div>
                </div>
            </div>
        </div>
        
        <div class="bench">
            <div class="bench-title">ü™ë Wissel:</div>
            <div class="bench-players" id="benchPlayers"></div>
        </div>
        
        <button class="share-btn" onclick="shareLineup()">üì§ Deel opstelling</button>
    </div>
    
    <div class="content" id="notities">
        <div class="score-display">
            <div class="score-teams">
                <span class="team-name" id="homeTeam">VVH</span>
                <span class="score-num" id="scoreHome">0</span>
                <span>-</span>
                <span class="score-num" id="scoreAway">0</span>
                <span class="team-name" id="awayTeam">TEG</span>
            </div>
        </div>
        
        <div class="note-buttons">
            <button class="note-btn goal" onclick="addNote('goal')"><span class="icon">‚öΩ</span>Goal</button>
            <button class="note-btn assist" onclick="addNote('assist')"><span class="icon">üëü</span>Assist</button>
            <button class="note-btn sub" onclick="addNote('sub')"><span class="icon">üîÑ</span>Wissel</button>
            <button class="note-btn good" onclick="addNote('good')"><span class="icon">‚≠ê</span>Goed</button>
            <button class="note-btn improve" onclick="addNote('improve')"><span class="icon">üìà</span>Beter</button>
            <button class="note-btn injury" onclick="addNote('injury')"><span class="icon">üè•</span>Blessure</button>
        </div>
        
        <button class="opponent-goal-btn" onclick="addOpponentGoal()">ü•Ö Tegendoelpunt</button>
        
        <div class="notes-list" id="notesList"></div>
        
        <button class="reset-btn" onclick="resetMatch()">üóë Reset wedstrijd</button>
    </div>
    
    <div class="content" id="verslag">
        <div class="info-card">
            <h3>üìä Wedstrijdverslag</h3>
            <div id="verslagContent">Nog geen notities</div>
        </div>
        <button class="share-btn" onclick="shareVerslag()">üì§ Deel verslag</button>
    </div>
    
    <div class="content" id="info">
        <div class="info-card">
            <h3>üìã Wedstrijd</h3>
            <div class="info-row"><span class="info-label">Tegenstander:</span><span class="info-value" id="infoOpponent">-</span></div>
            <div class="info-row"><span class="info-label">Datum:</span><span class="info-value" id="infoDate">-</span></div>
        </div>
        <div class="info-card">
            <h3>üë• Team</h3>
            <div class="info-row"><span class="info-label">Trainer:</span><span class="info-value" id="infoTrainer">-</span></div>
            <div class="info-row"><span class="info-label">Manager:</span><span class="info-value" id="infoManager">-</span></div>
            <div class="info-row"><span class="info-label">Spelers:</span><span class="info-value" id="infoPlayers">-</span></div>
        </div>
    </div>
    
    <!-- Player select modal -->
    <div class="modal" id="playerModal">
        <div class="modal-content">
            <div class="modal-title">Selecteer voor <span id="modalPosition"></span></div>
            <div class="modal-players" id="modalPlayers"></div>
            <button class="modal-close" onclick="closeModal()">Annuleren</button>
        </div>
    </div>
    
    <!-- Note modal (goal, assist, good, improve) -->
    <div class="modal" id="noteModal">
        <div class="modal-content">
            <div class="modal-title" id="noteModalTitle">Notitie</div>
            <select id="notePlayer">
                <option value="">-- Speler --</option>
            </select>
            <div class="modal-row">
                <select id="noteQuarter">
                    <option value="1">K1</option>
                    <option value="2">K2</option>
                    <option value="3">K3</option>
                    <option value="4">K4</option>
                </select>
                <input type="text" id="noteMinute" placeholder="min" style="max-width:80px;">
            </div>
            <textarea id="noteText" placeholder="Toelichting (optioneel)..."></textarea>
            <button class="modal-confirm" onclick="confirmNote()">‚úì Opslaan</button>
            <button class="modal-close" onclick="closeNoteModal()">Annuleren</button>
        </div>
    </div>
    
    <!-- Substitution modal -->
    <div class="modal" id="subModal">
        <div class="modal-content">
            <div class="modal-title">üîÑ Wissel</div>
            <div class="modal-subtitle">Speler ERUIT:</div>
            <select id="subPlayerOut">
                <option value="">-- Kies speler --</option>
            </select>
            <div class="modal-subtitle">Speler ERIN:</div>
            <select id="subPlayerIn">
                <option value="">-- Kies speler --</option>
            </select>
            <div class="modal-row">
                <select id="subQuarter">
                    <option value="1">K1</option>
                    <option value="2">K2</option>
                    <option value="3">K3</option>
                    <option value="4">K4</option>
                </select>
                <input type="text" id="subMinute" placeholder="min" style="max-width:80px;">
            </div>
            <textarea id="subText" placeholder="Toelichting (optioneel)..."></textarea>
            <button class="modal-confirm" onclick="confirmSub()">‚úì Opslaan</button>
            <button class="modal-close" onclick="closeSubModal()">Annuleren</button>
        </div>
    </div>
    
    <!-- Injury modal -->
    <div class="modal" id="injuryModal">
        <div class="modal-content">
            <div class="modal-title">üè• Blessure</div>
            <div class="modal-subtitle">Geblesseerde speler:</div>
            <select id="injuryPlayer">
                <option value="">-- Kies speler --</option>
            </select>
            <div class="modal-subtitle">Vervanger (optioneel):</div>
            <select id="injuryReplacement">
                <option value="">-- Geen vervanger --</option>
            </select>
            <div class="modal-row">
                <select id="injuryQuarter">
                    <option value="1">K1</option>
                    <option value="2">K2</option>
                    <option value="3">K3</option>
                    <option value="4">K4</option>
                </select>
                <input type="text" id="injuryMinute" placeholder="min" style="max-width:80px;">
            </div>
            <textarea id="injuryText" placeholder="Wat is er gebeurd?"></textarea>
            <button class="modal-confirm" onclick="confirmInjury()">‚úì Opslaan</button>
            <button class="modal-close" onclick="closeInjuryModal()">Annuleren</button>
        </div>
    </div>
    
    <!-- End quarter confirmation -->
    <div class="modal" id="endQuarterModal">
        <div class="modal-content">
            <div class="modal-title">‚èπ Kwart be√´indigen?</div>
            <p style="margin-bottom:15px;color:#aaa;">Weet je zeker dat je <strong id="endQuarterName">K1</strong> wilt be√´indigen?</p>
            <button class="modal-confirm" onclick="confirmEndQuarter()">‚úì Ja, be√´indig</button>
            <button class="modal-close" onclick="closeEndQuarterModal()">Annuleren</button>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyD7xLl7h6k7Z0xHnA1v1c1pMN0V2L3L4M8",
            authDomain: "jo10-14d44.firebaseapp.com",
            databaseURL: "https://jo10-14d44-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "jo10-14d44",
            storageBucket: "jo10-14d44.firebasestorage.app"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // Team data
        const teams = {
            'jo10-1': { naam: 'JO10-1', klasse: 'Hoofdklasse W1B3', trainer: 'Eric', manager: 'Dominique & Mark',
                spelers: ['Mees V.', 'Liam', 'Jairo', 'Yaer', 'Jeftha', 'Mees R.', 'Philine', 'Xander'] },
            'jo10-2': { naam: 'JO10-2', klasse: 'Hoofdklasse W1B5', trainer: 'Ryan', manager: 'Stefan',
                spelers: ['Fedde', 'Tian', 'Vince', 'Dex', 'Mees L.', 'James', 'Mert', 'Teije'] },
            'jo10-3': { naam: 'JO10-3', klasse: '1e Klasse 12', trainer: 'Gigi & Niels', manager: 'Hassan',
                spelers: ['Younes', 'Zayn', 'Siem', 'Freek', 'Morris', 'Seb', 'Job', 'Maud'] }
        };
        
        // Quarter timing (in seconds)
        const QUARTER_DURATION = 12.5 * 60; // 12:30
        const QUARTER_STARTS = { 1: 0, 2: 12.5*60, 3: 25*60, 4: 37.5*60 };
        
        let currentTeam = 'jo10-2';
        let currentQuarter = 1;
        let timerQuarter = 1;
        let timerSeconds = 0;
        let timerRunning = false;
        let timerInterval = null;
        let selectedPosition = null;
        let pendingNoteType = null;
        let matchData = { opponent: 'Tegenstander', scoreHome: 0, scoreAway: 0 };
        let notes = [];
        
        // Storage keys
        function getLineupKey() { return `jo10trainer_lineup_${currentTeam}`; }
        function getNotesKey() { return `jo10trainer_notes_${currentTeam}`; }
        function getMatchKey() { return `jo10trainer_match_${currentTeam}`; }
        
        let lineup = JSON.parse(localStorage.getItem(getLineupKey())) || {
            1: { K: '', LV: '', RV: '', MV: '', LA: '', RA: '' },
            2: { K: '', LV: '', RV: '', MV: '', LA: '', RA: '' },
            3: { K: '', LV: '', RV: '', MV: '', LA: '', RA: '' },
            4: { K: '', LV: '', RV: '', MV: '', LA: '', RA: '' }
        };
        
        // Timer functions
        function toggleTimer() {
            if (timerRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }
        
        function startTimer() {
            timerRunning = true;
            document.getElementById('timerBtn').textContent = '‚è∏ Pauze';
            document.getElementById('timerBtn').classList.remove('start');
            document.getElementById('timerBtn').classList.add('stop');
            document.querySelector(`.quarter-tab[data-quarter="${timerQuarter}"]`).classList.add('playing');
            
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
                
                // Check if quarter should end (12:30)
                const quarterElapsed = timerSeconds - QUARTER_STARTS[timerQuarter];
                if (quarterElapsed >= QUARTER_DURATION) {
                    endQuarter();
                }
            }, 1000);
        }
        
        function pauseTimer() {
            timerRunning = false;
            clearInterval(timerInterval);
            document.getElementById('timerBtn').textContent = '‚ñ∂ Start';
            document.getElementById('timerBtn').classList.add('start');
            document.getElementById('timerBtn').classList.remove('stop');
        }
        
        function updateTimerDisplay() {
            const mins = Math.floor(timerSeconds / 60);
            const secs = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
            document.getElementById('timerQuarter').textContent = `K${timerQuarter}`;
        }
        
        function endQuarter() {
            pauseTimer();
            
            // Vibrate if supported
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
            
            // Show toast
            showToast(`‚è± K${timerQuarter} be√´indigd!`);
            
            document.getElementById('timerQuarter').classList.add('ended');
            document.querySelector(`.quarter-tab[data-quarter="${timerQuarter}"]`).classList.remove('playing');
            
            // Move to next quarter if not K4
            if (timerQuarter < 4) {
                timerQuarter++;
                timerSeconds = QUARTER_STARTS[timerQuarter];
                currentQuarter = timerQuarter;
                updateQuarterTabs();
                setTimeout(() => {
                    document.getElementById('timerQuarter').classList.remove('ended');
                }, 2000);
            }
        }
        
        function endQuarterPrompt() {
            document.getElementById('endQuarterName').textContent = `K${timerQuarter}`;
            document.getElementById('endQuarterModal').classList.add('active');
        }
        
        function confirmEndQuarter() {
            closeEndQuarterModal();
            endQuarter();
        }
        
        function closeEndQuarterModal() {
            document.getElementById('endQuarterModal').classList.remove('active');
        }
        
        function getMatchMinute() {
            return Math.floor(timerSeconds / 60) + 1;
        }
        
        function getCurrentQuarterFromTimer() {
            if (timerSeconds < QUARTER_STARTS[2]) return 1;
            if (timerSeconds < QUARTER_STARTS[3]) return 2;
            if (timerSeconds < QUARTER_STARTS[4]) return 3;
            return 4;
        }
        
        // Team selection
        function selectTeam(teamId) {
            saveData();
            currentTeam = teamId;
            document.querySelectorAll('.team-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-team="${teamId}"]`).classList.add('active');
            
            lineup = JSON.parse(localStorage.getItem(getLineupKey())) || {
                1: {}, 2: {}, 3: {}, 4: {}
            };
            notes = JSON.parse(localStorage.getItem(getNotesKey())) || [];
            matchData = JSON.parse(localStorage.getItem(getMatchKey())) || { opponent: '', scoreHome: 0, scoreAway: 0 };
            
            updateUI();
        }
        
        function updateUI() {
            const team = teams[currentTeam];
            document.getElementById('matchInfo').textContent = `${team.naam} vs ${matchData.opponent || '...'}`;
            document.getElementById('homeTeam').textContent = team.naam;
            document.getElementById('awayTeam').textContent = (matchData.opponent || 'TEG').split(' ')[0];
            
            document.getElementById('infoTrainer').textContent = team.trainer;
            document.getElementById('infoManager').textContent = team.manager;
            document.getElementById('infoPlayers').textContent = team.spelers.length;
            document.getElementById('infoOpponent').textContent = matchData.opponent || '-';
            document.getElementById('infoDate').textContent = new Date().toLocaleDateString('nl-NL');
            
            populatePlayerSelects();
            renderLineup();
            renderNotes();
            renderVerslag();
            updateScore();
        }
        
        function populatePlayerSelects() {
            const team = teams[currentTeam];
            const options = '<option value="">-- Speler --</option>' +
                team.spelers.map(p => `<option value="${p}">${p}</option>`).join('');
            
            document.getElementById('notePlayer').innerHTML = options;
            document.getElementById('subPlayerOut').innerHTML = options;
            document.getElementById('subPlayerIn').innerHTML = options;
            document.getElementById('injuryPlayer').innerHTML = options;
            document.getElementById('injuryReplacement').innerHTML = 
                '<option value="">-- Geen vervanger --</option>' +
                team.spelers.map(p => `<option value="${p}">${p}</option>`).join('');
        }
        
        function updateQuarterTabs() {
            document.querySelectorAll('.quarter-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.quarter-tab[data-quarter="${currentQuarter}"]`).classList.add('active');
            renderLineup();
        }
        
        function renderLineup() {
            const q = lineup[currentQuarter] || {};
            const team = teams[currentTeam];
            ['K', 'LV', 'RV', 'MV', 'LA', 'RA'].forEach(pos => {
                document.getElementById(`pos-${pos}`).textContent = q[pos] || '-';
            });
            
            const onField = Object.values(q).filter(p => p);
            const bench = team.spelers.filter(p => !onField.includes(p));
            document.getElementById('benchPlayers').innerHTML = bench.length > 0 
                ? bench.map(p => `<div class="bench-player">${p}</div>`).join('')
                : '<span style="color:rgba(255,255,255,0.5);">-</span>';
        }
        
        // Quarter tabs
        document.querySelectorAll('.quarter-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                currentQuarter = parseInt(tab.dataset.quarter);
                updateQuarterTabs();
            });
        });
        
        // Main tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });
        
        // Position selection
        function selectPosition(pos) {
            selectedPosition = pos;
            document.getElementById('modalPosition').textContent = pos;
            
            const team = teams[currentTeam];
            const currentPlayers = Object.values(lineup[currentQuarter] || {});
            const available = team.spelers.filter(p => !currentPlayers.includes(p) || lineup[currentQuarter][pos] === p);
            
            document.getElementById('modalPlayers').innerHTML = `
                <div class="modal-player" onclick="assignPlayer('')">- Leeg -</div>
                ${available.map(p => `<div class="modal-player" onclick="assignPlayer('${p}')">${p}</div>`).join('')}
            `;
            document.getElementById('playerModal').classList.add('active');
        }
        
        function assignPlayer(name) {
            if (!lineup[currentQuarter]) lineup[currentQuarter] = {};
            lineup[currentQuarter][selectedPosition] = name;
            saveData();
            renderLineup();
            closeModal();
        }
        
        function closeModal() { document.getElementById('playerModal').classList.remove('active'); }
        
        // Notes
        function setNoteDefaults() {
            const currentQ = timerRunning ? getCurrentQuarterFromTimer() : timerQuarter;
            const currentMin = getMatchMinute();
            
            // If timer ended and note is added, use previous quarter last minute
            if (!timerRunning && timerSeconds > 0) {
                const quarterEnd = Math.floor(QUARTER_STARTS[timerQuarter] / 60) + 12;
                document.getElementById('noteMinute').value = quarterEnd;
            } else {
                document.getElementById('noteMinute').value = currentMin;
            }
            document.getElementById('noteQuarter').value = currentQ;
        }
        
        function addNote(type) {
            if (type === 'sub') {
                // Substitution modal
                document.getElementById('subQuarter').value = getCurrentQuarterFromTimer();
                document.getElementById('subMinute').value = getMatchMinute();
                document.getElementById('subPlayerOut').value = '';
                document.getElementById('subPlayerIn').value = '';
                document.getElementById('subText').value = '';
                document.getElementById('subModal').classList.add('active');
                return;
            }
            
            if (type === 'injury') {
                // Injury modal
                document.getElementById('injuryQuarter').value = getCurrentQuarterFromTimer();
                document.getElementById('injuryMinute').value = getMatchMinute();
                document.getElementById('injuryPlayer').value = '';
                document.getElementById('injuryReplacement').value = '';
                document.getElementById('injuryText').value = '';
                document.getElementById('injuryModal').classList.add('active');
                return;
            }
            
            pendingNoteType = type;
            const titles = { goal:'‚öΩ Goal', assist:'üëü Assist', good:'‚≠ê Goed moment', improve:'üìà Kan beter' };
            document.getElementById('noteModalTitle').textContent = titles[type];
            document.getElementById('notePlayer').value = '';
            document.getElementById('noteText').value = '';
            setNoteDefaults();
            document.getElementById('noteModal').classList.add('active');
        }
        
        function confirmNote() {
            const player = document.getElementById('notePlayer').value;
            if (!player) { alert('Selecteer een speler'); return; }
            
            const note = {
                type: pendingNoteType,
                player,
                quarter: parseInt(document.getElementById('noteQuarter').value),
                minute: parseInt(document.getElementById('noteMinute').value) || getMatchMinute(),
                text: document.getElementById('noteText').value,
                timestamp: Date.now()
            };
            
            notes.push(note);
            if (note.type === 'goal') { matchData.scoreHome++; updateScore(); }
            saveData();
            renderNotes();
            renderVerslag();
            closeNoteModal();
            showToast('‚úì Opgeslagen');
        }
        
        function confirmSub() {
            const playerOut = document.getElementById('subPlayerOut').value;
            const playerIn = document.getElementById('subPlayerIn').value;
            if (!playerOut || !playerIn) { alert('Selecteer beide spelers'); return; }
            
            notes.push({
                type: 'sub',
                playerOut,
                playerIn,
                quarter: parseInt(document.getElementById('subQuarter').value),
                minute: parseInt(document.getElementById('subMinute').value) || getMatchMinute(),
                text: document.getElementById('subText').value,
                timestamp: Date.now()
            });
            saveData();
            renderNotes();
            renderVerslag();
            closeSubModal();
            showToast('‚úì Wissel opgeslagen');
        }
        
        function confirmInjury() {
            const player = document.getElementById('injuryPlayer').value;
            if (!player) { alert('Selecteer de geblesseerde speler'); return; }
            
            const replacement = document.getElementById('injuryReplacement').value;
            
            notes.push({
                type: 'injury',
                player,
                replacement: replacement || null,
                quarter: parseInt(document.getElementById('injuryQuarter').value),
                minute: parseInt(document.getElementById('injuryMinute').value) || getMatchMinute(),
                text: document.getElementById('injuryText').value,
                timestamp: Date.now()
            });
            saveData();
            renderNotes();
            renderVerslag();
            closeInjuryModal();
            showToast('‚úì Blessure opgeslagen');
        }
        
        function addOpponentGoal() {
            notes.push({
                type: 'opponent_goal',
                quarter: getCurrentQuarterFromTimer(),
                minute: getMatchMinute(),
                timestamp: Date.now()
            });
            matchData.scoreAway++;
            saveData();
            updateScore();
            renderNotes();
            renderVerslag();
        }
        
        function closeNoteModal() { document.getElementById('noteModal').classList.remove('active'); }
        function closeSubModal() { document.getElementById('subModal').classList.remove('active'); }
        function closeInjuryModal() { document.getElementById('injuryModal').classList.remove('active'); }
        
        function deleteNote(index) {
            const note = notes[index];
            if (note.type === 'goal') matchData.scoreHome--;
            if (note.type === 'opponent_goal') matchData.scoreAway--;
            notes.splice(index, 1);
            saveData();
            updateScore();
            renderNotes();
            renderVerslag();
        }
        
        function renderNotes() {
            const icons = { goal:'‚öΩ', assist:'üëü', injury:'üè•', good:'‚≠ê', improve:'üìà', sub:'üîÑ', opponent_goal:'ü•Ö' };
            
            // Sort by quarter then minute (chronological)
            const sorted = [...notes].sort((a, b) => {
                if (a.quarter !== b.quarter) return a.quarter - b.quarter;
                return a.minute - b.minute;
            }).reverse(); // Most recent first in list
            
            document.getElementById('notesList').innerHTML = sorted.map((n, origIdx) => {
                const idx = notes.indexOf(n);
                let content = '';
                
                if (n.type === 'sub') {
                    content = `<strong>${icons.sub} ${n.playerOut} ‚ûú ${n.playerIn}</strong>`;
                } else if (n.type === 'injury') {
                    content = `<strong>${icons.injury} ${n.player}</strong>`;
                    if (n.replacement) content += ` ‚ûú ${n.replacement}`;
                } else if (n.type === 'opponent_goal') {
                    content = `<strong>${icons.opponent_goal} Tegendoelpunt</strong>`;
                } else {
                    content = `<strong>${icons[n.type]} ${n.player}</strong>`;
                }
                
                return `
                    <div class="note-item ${n.type}">
                        <div class="note-time">K${n.quarter} ${n.minute}'</div>
                        ${content}
                        ${n.text ? `<br><span style="color:#aaa">${n.text}</span>` : ''}
                        <button class="delete-note" onclick="deleteNote(${idx})">√ó</button>
                    </div>
                `;
            }).join('') || '<p style="text-align:center;color:#666">Geen notities</p>';
        }
        
        function renderVerslag() {
            const team = teams[currentTeam];
            const icons = { goal:'‚öΩ', assist:'üëü', injury:'üè•', good:'‚≠ê', improve:'üìà', sub:'üîÑ', opponent_goal:'ü•Ö' };
            
            // Sort chronologically
            const sorted = [...notes].sort((a, b) => {
                if (a.quarter !== b.quarter) return a.quarter - b.quarter;
                return a.minute - b.minute;
            });
            
            if (sorted.length === 0) {
                document.getElementById('verslagContent').innerHTML = '<p style="color:#666">Nog geen notities</p>';
                return;
            }
            
            let html = `<p><strong>${team.naam} ${matchData.scoreHome} - ${matchData.scoreAway} ${matchData.opponent}</strong></p><hr style="border-color:#003087;margin:10px 0;">`;
            
            let currentQ = 0;
            sorted.forEach(n => {
                if (n.quarter !== currentQ) {
                    currentQ = n.quarter;
                    html += `<p style="color:#FFD700;font-weight:bold;margin-top:10px;">Kwart ${currentQ}</p>`;
                }
                
                let line = `${n.minute}' `;
                if (n.type === 'sub') {
                    line += `${icons.sub} Wissel: ${n.playerOut} eruit, ${n.playerIn} erin`;
                } else if (n.type === 'injury') {
                    line += `${icons.injury} Blessure: ${n.player}`;
                    if (n.replacement) line += ` (vervangen door ${n.replacement})`;
                } else if (n.type === 'opponent_goal') {
                    line += `${icons.opponent_goal} Tegendoelpunt`;
                } else if (n.type === 'goal') {
                    line += `${icons.goal} GOAL: ${n.player}`;
                } else if (n.type === 'assist') {
                    line += `${icons.assist} Assist: ${n.player}`;
                } else {
                    line += `${icons[n.type]} ${n.player}`;
                }
                if (n.text) line += ` - ${n.text}`;
                
                html += `<p style="margin:4px 0;font-size:0.9em;">${line}</p>`;
            });
            
            document.getElementById('verslagContent').innerHTML = html;
        }
        
        function updateScore() {
            document.getElementById('scoreHome').textContent = matchData.scoreHome;
            document.getElementById('scoreAway').textContent = matchData.scoreAway;
        }
        
        function shareLineup() {
            const team = teams[currentTeam];
            let text = `‚öΩ ${team.naam} vs ${matchData.opponent}\n\n`;
            for (let q = 1; q <= 4; q++) {
                const l = lineup[q] || {};
                const onField = Object.values(l).filter(p => p);
                const bench = team.spelers.filter(p => !onField.includes(p));
                text += `üìã K${q}: K:${l.K||'-'} | LV:${l.LV||'-'} RV:${l.RV||'-'} | MV:${l.MV||'-'} | LA:${l.LA||'-'} RA:${l.RA||'-'}\nü™ë ${bench.join(', ')||'-'}\n\n`;
            }
            shareText(text);
        }
        
        function shareVerslag() {
            const team = teams[currentTeam];
            const icons = { goal:'‚öΩ', assist:'üëü', injury:'üè•', good:'‚≠ê', improve:'üìà', sub:'üîÑ', opponent_goal:'ü•Ö' };
            
            let text = `üìä WEDSTRIJDVERSLAG\n${team.naam} ${matchData.scoreHome} - ${matchData.scoreAway} ${matchData.opponent}\n${new Date().toLocaleDateString('nl-NL')}\n\n`;
            
            const sorted = [...notes].sort((a, b) => {
                if (a.quarter !== b.quarter) return a.quarter - b.quarter;
                return a.minute - b.minute;
            });
            
            let currentQ = 0;
            sorted.forEach(n => {
                if (n.quarter !== currentQ) {
                    currentQ = n.quarter;
                    text += `\n--- Kwart ${currentQ} ---\n`;
                }
                
                let line = `${n.minute}' `;
                if (n.type === 'sub') {
                    line += `üîÑ ${n.playerOut} ‚ûú ${n.playerIn}`;
                } else if (n.type === 'injury') {
                    line += `üè• ${n.player}`;
                    if (n.replacement) line += ` ‚ûú ${n.replacement}`;
                } else if (n.type === 'opponent_goal') {
                    line += `ü•Ö Tegendoelpunt`;
                } else {
                    line += `${icons[n.type]} ${n.player}`;
                }
                if (n.text) line += ` (${n.text})`;
                text += line + '\n';
            });
            
            shareText(text);
        }
        
        function shareText(text) {
            if (navigator.share) {
                navigator.share({ title: 'JO10 Wedstrijd', text });
            } else {
                navigator.clipboard.writeText(text);
                showToast('üìã Gekopieerd!');
            }
        }
        
        function resetMatch() {
            if (!confirm('Weet je zeker dat je de hele wedstrijd wilt resetten? Alle notities worden gewist.')) return;
            notes = [];
            matchData.scoreHome = 0;
            matchData.scoreAway = 0;
            timerSeconds = 0;
            timerQuarter = 1;
            pauseTimer();
            updateTimerDisplay();
            saveData();
            updateScore();
            renderNotes();
            renderVerslag();
            showToast('üóë Wedstrijd gereset');
        }
        
        function saveData() {
            localStorage.setItem(getLineupKey(), JSON.stringify(lineup));
            localStorage.setItem(getNotesKey(), JSON.stringify(notes));
            localStorage.setItem(getMatchKey(), JSON.stringify(matchData));
        }
        
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        // Init
        updateUI();
        updateTimerDisplay();
    </script>
</body>
</html>
